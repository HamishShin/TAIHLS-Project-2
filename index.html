<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gradient Descent Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f7fafc; }
        #gdCanvas {
            border: 2px solid #cbd5e1;
            border-radius: 0.5rem;
            background-color: white;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
            display: block;
        }
    </style>
</head>
<body class="p-4 sm:p-8 flex flex-col items-center min-h-screen">

    <div class="w-full max-w-4xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-gray-900">Gradient Descent Demonstrator</h1>
            <p class="text-lg text-gray-600 mt-2">Visualizing Linear Regression Convergence</p>
        </header>

        <!-- MAIN GRID -->
        <main class="grid lg:grid-cols-3 gap-8 auto-rows-max w-full">

            <!-- Canvas Section -->
            <div class="lg:col-span-2 min-w-0">
                <canvas id="gdCanvas" width="600" height="400"></canvas>
                <div class="mt-4 p-4 bg-gray-100 rounded-lg shadow-inner">
                    <p class="text-sm text-gray-700">The blue dots are the dataset. The red line represents the current linear model, which moves during each iteration of the gradient descent algorithm.</p>
                </div>
            </div>

            <!-- Control Section -->
            <div class="lg:col-span-1 min-w-0 space-y-6">

                <div class="bg-white p-6 rounded-xl shadow-lg border border-indigo-100">
                    <h2 class="text-xl font-semibold mb-4 text-indigo-700">Model Performance</h2>
                    <div class="space-y-2 text-sm">
                        <p class="flex justify-between text-gray-700"><span>Iteration:</span><span id="iterationCount">0</span></p>
                        <p class="flex justify-between text-gray-700"><span>Current Cost (J):</span><span id="currentCost">N/A</span></p>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-lg border border-purple-100">
                    <h2 class="text-xl font-semibold mb-4 text-purple-700">Current Parameters</h2>
                    <div class="space-y-2 text-sm">
                        <p class="flex justify-between text-gray-700"><span>θ0:</span><span id="theta0">0.000</span></p>
                        <p class="flex justify-between text-gray-700"><span>θ1:</span><span id="theta1">0.000</span></p>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-lg border border-green-100">
                    <h2 class="text-xl font-semibold mb-4 text-green-700">Controls</h2>
                    <button id="toggleButton" class="w-full py-3 px-4 bg-green-500 text-white rounded-lg shadow-md">Start Descent</button>
                    <button id="resetButton" class="w-full mt-3 py-2 px-4 bg-gray-300 text-gray-800 rounded-lg">Reset</button>
                    <p class="text-xs text-center text-gray-500 mt-4">Learning Rate (α): 0.01</p>
                </div>
            </div>

        </main>

        <!-- Neuron link -->
        <div class="text-center mt-10">
            <a href="Neuron.html" class="text-indigo-600 font-semibold hover:underline text-lg">Go to Neuron Visualizer →</a>
        </div>
    </div>

    <!-- Gradient Descent JS -->
    <script>
    (function () {
        const canvas = document.getElementById('gdCanvas');
        const ctx = canvas.getContext('2d');
        const iterEl = document.getElementById('iterationCount');
        const costEl = document.getElementById('currentCost');
        const th0El = document.getElementById('theta0');
        const th1El = document.getElementById('theta1');
        const toggleBtn = document.getElementById('toggleButton');
        const resetBtn = document.getElementById('resetButton');

        function resizeCanvasForDPR() {
            const dpr = window.devicePixelRatio || 1;
            const cssW = canvas.width;
            const cssH = canvas.height;
            canvas.style.width = cssW + 'px';
            canvas.style.height = cssH + 'px';
            canvas.width = cssW * dpr;
            canvas.height = cssH * dpr;
            ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        }
        resizeCanvasForDPR();

        let data = [];
        let m = 0;
        let theta0 = 0;
        let theta1 = 0;
        let alpha = 0.01;
        let iteration = 0;
        let running = false;
        let rafId = null;
        const iterationsPerFrame = 5;

        function generateData(n=40){
            data = [];
            for (let i=0;i<n;i++){
                const x = Math.random()*10;
                const noise = (Math.random()-0.5)*4;
                const y = 1.5 + 2*x + noise;
                data.push({x,y});
            }
            m = data.length;
        }

        function h(x){ return theta0 + theta1*x; }

        function computeCost(){
            if(m===0) return NaN;
            let s=0;
            for(let i=0;i<m;i++){
                const err = h(data[i].x)-data[i].y;
                s += err*err;
            }
            return s/(2*m);
        }

        function gradientStep(){
            let g0=0,g1=0;
            for(let i=0;i<m;i++){
                const xi=data[i].x;
                const err = h(xi)-data[i].y;
                g0+=err;
                g1+=err*xi;
            }
            g0/=m; g1/=m;
            theta0 -= alpha*g0;
            theta1 -= alpha*g1;
        }

        function getBounds(){
            const xs = data.map(d=>d.x);
            const ys = data.map(d=>d.y);
            const minX = Math.min(...xs), maxX=Math.max(...xs);
            const minY = Math.min(...ys), maxY=Math.max(...ys);
            const padX = (maxX-minX)*0.08||1;
            const padY = (maxY-minY)*0.12||1;
            return {minX:minX-padX,maxX:maxX+padX,minY:minY-padY,maxY:maxY+padY};
        }

        function dataToCanvas(x,y,bounds){
            const cssW = parseFloat(canvas.style.width);
            const cssH = parseFloat(canvas.style.height);
            const left = 40, right=20, top=20, bottom=30;
            const plotW = cssW-left-right;
            const plotH = cssH-top-bottom;
            const tX=(x-bounds.minX)/(bounds.maxX-bounds.minX);
            const tY=(y-bounds.minY)/(bounds.maxY-bounds.minY);
            const px = left + tX*plotW;
            const py = top + (1-tY)*plotH;
            return {px,py,plotW,plotH,left,top};
        }

        function drawScene(){
            const cssW = parseFloat(canvas.style.width);
            const cssH = parseFloat(canvas.style.height);
            ctx.clearRect(0,0,cssW,cssH);
            if(data.length===0) return;
            const bounds = getBounds();

            // Draw points
            for(let i=0;i<m;i++){
                const {px,py} = dataToCanvas(data[i].x,data[i].y,bounds);
                ctx.beginPath();
                ctx.fillStyle="#2563eb";
                ctx.arc(px,py,4,0,Math.PI*2);
                ctx.fill();
            }

            // Draw line
            const p1 = dataToCanvas(bounds.minX,h(bounds.minX),bounds);
            const p2 = dataToCanvas(bounds.maxX,h(bounds.maxX),bounds);
            ctx.beginPath();
            ctx.moveTo(p1.px,p1.py);
            ctx.lineTo(p2.px,p2.py);
            ctx.lineWidth=2.5;
            ctx.strokeStyle="#ef4444";
            ctx.stroke();
        }

        function updateUI(){
            iterEl.textContent=iteration;
            const cost = computeCost();
            costEl.textContent = Number.isFinite(cost)? cost.toFixed(4):'N/A';
            th0El.textContent=theta0.toFixed(3);
            th1El.textContent=theta1.toFixed(3);
        }

        function loop(){
            for(let k=0;k<iterationsPerFrame;k++){
                if(!running) break;
                gradientStep();
                iteration++;
            }
            drawScene();
            updateUI();
            if(running) rafId=requestAnimationFrame(loop);
            else rafId=null;
        }

        toggleBtn.addEventListener('click',()=>{
            running = !running;
            toggleBtn.textContent = running?'Pause':'Start Descent';
            if(running && !rafId) rafId=requestAnimationFrame(loop);
        });

        resetBtn.addEventListener('click',()=>{
            running=false;
            if(rafId){ cancelAnimationFrame(rafId); rafId=null; }
            theta0=0; theta1=0; iteration=0;
            generateData(40);
            drawScene();
            updateUI();
            toggleBtn.textContent='Start Descent';
        });

        function init(){
            generateData(40);
            theta0=0; theta1=0; iteration=0;
            running=false;
            drawScene();
            updateUI();
        }

        init();
    })();
    </script>
</body>
</html>
